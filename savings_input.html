<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YS6P9SVTRP"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-YS6P9SVTRP');
    </script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="favicon.ico" type="image/x-icon">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<title>Habitat - Deposit Calculator - Find my Budget</title>
<style>
    body {
        font-family: 'Montserrat', sans-serif;
        text-align: center;
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #ECFCEC;
        color: #006400;
    }
    .header {
            position: fixed; /* Fix the header to the top */
            top: 0; /* Align to the top */
            left: 0; /* Align to the left */
            display: flex;
            align-items: center;
            padding: 10px 20px; /* Add padding around the header */
            background-color: #ECFCEC;

            width: 100%; /* Full width */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Shadow for subtle depth */
            z-index: 10; /* Ensure it's above other content */
    }

    .header img {
        max-width: 60px; /* Adjust the logo size */
        height: auto;
        margin-right: 10px; /* Reduce space between logo and title */
    }

    .header h1 {
        margin: 0; /* Remove default margin */
        font-size: 1.5em; /* Smaller title size */
        color: #006400;
        text-align: left;
    }
    .container {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        width: 100%; /* Take full width */
        max-width: 1800px; /* Limit maximum width */
        margin-top: 20px;
    }
    h2 {
        font-size: 36px; /* Increase font size of h2 */
        color: #006400;
        margin-top: 100px; /* Move h2 down */
    }

    .form-container {
        flex-grow: 1; /* Take up remaining space */
        padding: 20px;
        border: 1px solid #808080;
        border-radius: 8px;
        background-color: #FCFBF0;
        margin-top: 60px;
        color: #006400;
        margin-left: 10px;
        margin-right: 10px;
    }
    select#state,
    select#deposit_percentage {
        width: 40%;
        padding: 10px;
        font-size: 16px;
        box-sizing: border-box;
        margin-bottom: 10px;
    }
    input#current_savings {
        width: 70%;
        padding: 10px;
        font-size: 16px;
        box-sizing: border-box;
        margin-bottom: 10px;
    }
    .result-container {
        flex-basis: 100%;
        margin-top: 20px;
        max-width: 1200px;
        padding: 20px;
        color: #006400;
    }

    /* Media query for smaller screens (like phones) */
    @media only screen and (max-width: 950px) {
        .container {
            width: 80%;
            flex-direction: column;
            align-items: center;
        }
        .form-container {
            margin-right: 0;
        }
        .result-container {
        }
        .tiles {
            flex-direction: column; /* Stack tiles vertically on small screens */
            align-items: center; /* Center align the tiles */
        }
        .tile {
            width: calc(100% - 20px); /* Full width minus margin for smaller screens */
            margin: 10px 0; /* Vertical margin for stacked tiles */
        }
        h2 {
        font-size:24px; /* Increase font size of h2 */
        color: #006400;
        margin-top: 60px; /* Move h2 down */
    }
    }
    .result {
        border: 1px solid #808080;
        border-radius: 8px;
        background-color: #FCFBF0;
        color: #006400;
    }
    .accordion {
        background-color: #fff;
        color: #006400;
        cursor: pointer;
        padding: 18px;
        width: 100%;
        text-align: left;
        border: 1px solid #ddd;
        outline: none;
        transition: background-color 0.3s ease;
    }
    .accordion.active,
    .accordion:hover {
        background-color: #C7F5C7;
    }
    .panel {
        padding: 0 18px;
        display: none;
        background-color: white;
        overflow: hidden;
        text-align: left;
    }
    .panel.show {
        display: block;
    }
    form {
        text-align: center;
        width: 100%;
        max-width: 400px;
        margin: auto;
    }
    label {
        display: block;
        margin-bottom: 10px;
        color: #808080;
    }
    .tiles {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        flex-wrap: wrap; /* Allow tiles to wrap if there's not enough space */
    }
    .tile {
        flex: 1; /* Each tile will take up equal space */
        text-align: center;
        cursor: pointer;
        padding: 10px;
        border: 1px solid #808080;
        border-radius: 8px;
        background-color: #fff;
        transition: background-color 1s ease;
        margin: 5px; /* Space between tiles */
        box-sizing: border-box; /* Include padding and border in the element's total width and height */
    }
    .tile.selected {
        background-color: #C7F5C7;
    }
    .button-container {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }
    button {
        padding: 10px 20px;
        font-family: 'Montserrat', sans-serif;
        font-size: 16px;
        cursor: pointer;
        background-color: #006400;
        color: #fff;
        border: none;
        border-radius: 4px;
        transition: background-color 0.3s ease;
    }
    button:hover {
        background-color: #C7F5C7;
        color: #006400;
    }
    .result {
        margin-top: 20px;
        font-size: 18px;
        text-align: center;
    }
    .result p {
        margin: 10px 0;
        color: #808080;
    }
    .result.bold {
        font-weight: bold;
        font-size: 24px;
        color: #006400;
    }
    .info-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            font-size: 14px;
            background-color: #ffffff; /* Background color */
            color: #006400; /* Text color */
            border-radius: 50%; /* Rounded shape */
            cursor: pointer; /* Show pointer cursor on hover */
            margin-left: 5px; /* Adjust spacing */
        }
        /* Modal styles */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1000; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 80%; /* Could be more or less, depending on screen size */
        max-width: 600px; /* Responsive width */
        border-radius: 10px; /* Rounded corners */
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

</style>
</head>
<body>
    <div class="header">
        <img src="light-green-back-dark-green-logo.PNG" alt="Habitat Logo">
        <h1>Habitat</h1>
    </div>
    <h2>Home Loan Deposit Calculator</h2>
    <div class="container">
        <div class="form-container">
            <form id="inputForm">
                <label for="house_type">
                    What type of home are you looking to buy? 
                    <span class="info-icon" onclick="showHelpInfo()">i</span>
                </label>
                <div class="tiles">
                    <div class="tile" id="established" onclick="toggleTile(this,'house_type','established')"> Established Home</div>
                    <div class="tile" id="build" onclick="toggleTile(this,'house_type','build')">New Home</div>
                    <div class="tile" id="land" onclick="toggleTile(this,'house_type','land')">Land to Build On</div>
                    <input type="hidden" id="house_type" name="house_type" value="established">
                </div>
                <br>
                <label for="state">What State are you purchasing in?:</label>
                <select id="state" name="state">
                    <option value="NSW">NSW</option>
                    <option value="VIC">VIC</option>
                    <option value="QLD">QLD</option>
                    <option value="WA">WA</option>
                    <option value="SA">SA</option>
                    <option value="TAS">TAS</option>
                    <option value="ACT">ACT</option>
                    <option value="NT">NT</option>
                </select>
                <br>
                <label>Are you buying in a Regional or Metro area?</label>
                <div class="tiles">
                    <div class="tile" id="regional" onclick="toggleTile(this,'regional','Yes')">Regional</div>
                    <div class="tile" id="metro" onclick="toggleTile(this,'regional','No')">Metro</div>
                    <input type="hidden" id="regional" name="regional" value="Y">
                </div>
                <br>
                <label for="current_savings">How much do you have saved? ($):</label>
                <input type="text" id="current_savings" name="current_savings" oninput="formatPrice(this)" required>
                <br>
                <label for="first_home_buyer">
                    Are you a First Home Buyer?
                    <span class="info-icon" onclick="showHelpInfo()">i</span>

                </label>
                <div class="tiles">
                    <div class="tile" id="first_home_buyer_yes" onclick="toggleTile(this,'first_home_buyer','first_home_buyer_yes')">Yes</div>
                    <div class="tile" id="first_home_buyer_no" onclick="toggleTile(this,'first_home_buyer','first_home_buyer_no')">No</div>
                    <input type="hidden" id="first_home_buyer" name="first_home_buyer" value="first_home_buyer_no">
                </div>
                <br>
                <label for="first_home_guarantee">
                    Are you eligible for the First Home Buyer Guarantee?
                    <span class="info-icon" onclick="showHelpInfo()">i</span>
                </label>
                <div class="tiles">
                    <div class="tile" id="first_home_guarantee_yes" onclick="toggleTile(this,'first_home_guarantee','first_home_guarantee_yes')">Yes</div>
                    <div class="tile" id="first_home_guarantee_no" onclick="toggleTile(this,'first_home_guarantee','first_home_guarantee_no')">No</div>
                    <input type="hidden" id="first_home_guarantee" name="first_home_guarantee" value="first_home_guarantee_no">
                </div>
                <br>
                <label for="guarantor">
                    Do you have a guarantor?
                    <span class="info-icon" onclick="showHelpInfo()">i</span>
                <div class="tiles">
                    <div class="tile" id="guarantor_yes" onclick="toggleTile(this,'guarantor','guarantor_yes')">Yes</div>
                    <div class="tile" id="guarantor_no" onclick="toggleTile(this,'guarantor','guarantor_no')">No</div>
                    <input type="hidden" id="guarantor" name="guarantor" value="guarantor_no">
                </div>
                <br>
                <label>Select % Deposit:</label>
                <select id="deposit_percentage" name="deposit_percentage">
                    <option value="0.2">20%</option>
                    <option value="0.15">15%</option>
                    <option value="0.1">10%</option>
                    <option value="0.05">5%</option>
                </select>
                <div class="button-container">
                    <button type="button" onclick="display(findMaxHousePrice().house_price)">Calculate Deposit</button>
                </div>
            </form>
        </div>

        <div class="result-container">
            <div class="result">
                <p style="font-weight: bold;" id="maxHousePrice">Maximum Property Value Price: </p>
                <p style="font-weight: bold;" id="amountRequired">Savings Required: </p>
                <p id="FHOG">First Home Owner Grant: </p>
            </div>
            <div class="result">
                <p style="font-weight: bold;" id="total_fees">Total Fees: </p>
                <p id="stampDutyResult">Stamp Duty: </p>
                <p id="stampDutyConc">Stamp Duty Concessions: </p>
                <p id="otherGovtCostsResult">Other Govt Costs: </p>
                <p id="Conveyancing">Conveyancing Fees: </p>
                <p id="LMI">LMI (Lenders Mortgage Insurance): </p>
            </div>
            <div class="result">
                <p style="font-weight: bold;" id="loanValue">Loan Value: </p>
            </div>
            <br>
            <button class="accordion">Want to see some options to reduce your deposit required?</button>
            <div class="panel">
                <p id="accordionOption1"></p>
                <p id="accordionOption2"></p>
                <p id="accordionOption3"></p>
                <p id="accordionOption4"></p>
                <p id="accordionOption5"></p>
                <p id="accordionOption6"></p>
                <p id="accordionOption7"></p>
            </div>
            <button class="accordion">Eligibility Criteria Assumptions</button>
            <div class="panel">
                <p id="accordionCriteria1"></p>
                <p id="accordionCriteria2"></p>
                <p id="accordionCriteria3"></p>
                <p id="accordionCriteria4"></p>
                <p id="accordionCriteria5"></p>
                <p id="accordionCriteria6"></p>
                <p id="accordionCriteria7"></p>
            </div>
                
        </div>
        
    </div>

    <div id="dataPolicyModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h4>Data Collection Policy</h4>
          <p>We collect the data you enter into our calculators & tools to improve our services. By continuing to use this site, you agree to our data collection policy. For more information, please refer to our <a href="privacy-policy.html">Privacy Policy</a>.</p>
          <button id="acceptBtn">I Accept</button>
        </div>
      </div>

    <script>
        var modal = document.getElementById("dataPolicyModal");

        // Get the button that opens the modal
        var acceptBtn = document.getElementById("acceptBtn");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // Show the modal when the page loads
        window.onload = function() {
            modal.style.display = "block";
        };

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        };

        // When the user clicks on the "I Accept" button, close the modal
        acceptBtn.onclick = function() {
            modal.style.display = "none";
            // You can also set a cookie or local storage item here to remember the user's acceptance
            localStorage.setItem('dataPolicyAccepted', 'true');
        };

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        };

        // Check if the data policy has been accepted before showing the content
        window.onload = function() {
            if (!localStorage.getItem('dataPolicyAccepted')) {
                modal.style.display = "block";
            } else {
                // Optionally, you could hide the modal and show content if the policy is accepted
            }
        };
        function showHelpInfo() {
            window.open("help.html", "_blank");
        }

        // Function to position tooltip next to its corresponding info icon
        function positionTooltip(element, tooltip) {
            const iconRect = element.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();

            // Calculate the position
            const top = iconRect.top + window.scrollY; // Adjust as needed
            const left = iconRect.right + window.scrollX + 100; // Position to the right of the icon

            tooltip.style.top = top + 'px';
            tooltip.style.left = left + 'px';
        }

        function toggleTile(tile,variable,value) {
            var tiles = tile.parentElement.querySelectorAll('.tile');
            tiles.forEach(function(item) {
                item.classList.remove('selected');
            });
            tile.classList.add('selected');
            document.getElementById(variable).value = value;
            updateDepositOptions(); 
        }

        function populateAccordions(outputs) {
            // Populate Criteria list
            var months = outputs.months_residence_req;
            var criteria_counter = 0;
            var criteria1 = "";
            var criteria2 = "";
            var criteria3 = "";
            var criteria4 = "";
            if(outputs.first_home_guarantee=="first_home_guarantee_yes"){
                criteria1 = ` <strong>First Home Buyer Guarantee </strong> <br> To be eligible for the First Home Buyers Guarantee you must be a first home owner and have an income under $125,000 for individuals and $200,000 for joint applicants. <br> You must also apply through a lender that participates in the Home Buyers Guarantee`
            }
            if(outputs.FHOG>0){
                criteria2 = `<strong>First Home Owner Grant </strong> <br> You must be purchasing a new home that has not been previously occupied or sold as a place of residence which includes a substantially renovated home. <br>
                You or your spouse must not have previously owned/held an interest in a residential property in Australia. <br>
                You must reside in the home as your principal place of residence for a continuous period of ${months} months. With that period beginning within 12 months of the settlement date of the property`
            }
            if(outputs.stamp_duty_concession > 0){
                criteria3 = `<strong>Stamp Duty Concession </strong> <br> You must be purchasing a new home or land that has not been previously occupied or sold as a place of residence which includes a substantially renovated home.
                <br>You or your spouse must not have previously owned/held an interest in a  residential property in Australia.`
            }
            if(outputs.guarantor=="guarantor_yes"){
                criteria4 = `<strong>Guarantor </strong> <br> Your guarantor will also need to be a home owner as their home equity forms part of the security for your first home loan. <br>  Most lenders will only allow a guarantor to be an immediate family member.`
            }

            

            document.getElementById('accordionCriteria1').innerHTML = criteria1;
            document.getElementById('accordionCriteria2').innerHTML = criteria2;
            document.getElementById('accordionCriteria3').innerHTML = criteria3;
            document.getElementById('accordionCriteria4').innerHTML = criteria4;

            // Populate Options to reduce savings required 
            var option_counter = 0;
            var option1 = "";
            var option2 = "";
            var option3 = "";
            var option4 = "";
            var option5 = "";
            var option6 = "";
            var option7 = "";

            if(outputs.LMI > 0){
                option_counter++;
                option1 = `<strong>Option ${option_counter} - First Home Buyer Guarantee </strong> <br>Are you eligible for the First Home Buyer Guarantee? This would allow you to pay $0 in LMI.`;
                option_counter++;
                option2 = `<strong>Option ${option_counter} - Guarantor </strong> <br> Could you find a guarantor for your loan? Possibly a parent of family member, as this would allow you to pay $0 in LMI.`;
            }
            if(outputs.house_type == "established" && outputs.first_home_buyer == "first_home_buyer_yes"){
                option_counter++;
                option3 = `<strong>Option ${option_counter} - Opt for a New Home </strong> <br> Have you thought about buying a new property? Most state governments have grants & concessions available for First Home Buyers buying new homes.`;

            }
            if(outputs.deposit_percentage > 0.05){
                option_counter++;
                option4 = `<strong>Option ${option_counter} - Reduce your deposit </strong> <br> You could consider reducing your % Deposit, this will reduce the savings you need to get into the market. However, it will result in a bigger loan which can result in the loan exceeding your borrowing power or impact the interest rate you are offered by your lender`;
            }
            
            if(outputs.house_type != "established" && outputs.first_home_buyer == "first_home_buyer_yes" && outputs.FHOG == 0){
                option_counter++;
                option5 = `<strong>Option ${option_counter} - Buy a property below the FHOG Price Threshold </strong> <br> You seem to be above the FHOG Threshold for your state. If you reduce your House Price Budget you'll be able to access the First Home Owner Grant.`;
            }

            if(outputs.first_home_buyer == "first_home_buyer_yes" && outputs.stamp_duty_concession == 0){
                option_counter++;
                option6 = `<strong>Option ${option_counter} - Buy a property below the Stamp Duty Concession Price Threshold </strong> <br> You seem to be above the Stamp Duty Concession Threshold for your state. If you reduce your House Price you'll start to receive stamp duty concessions and reduce your overall fees.`;
            }

            if(option_counter == 0){
                option_counter++;
                option7 = "You seem to be making the most of all the grants & concessions available to you. You may need to reduce your budget or save for a bit longer to reach a property of the price you're looking for.";
            } else {
                option_counter++;
                if(option_counter == 1){
                    option7 = `<br> If the option above isn't feasible for you, you may just need to reduce your property value budget or save for a bit longer.`;
                } else{
                    option7 = `<br> If the options above aren't feasible for you, you may just need to reduce your property value budget or save for a bit longer.`;
                }
            }


            document.getElementById('accordionOption1').innerHTML = option1;
            document.getElementById('accordionOption2').innerHTML = option2;
            document.getElementById('accordionOption3').innerHTML = option3;
            document.getElementById('accordionOption4').innerHTML = option4;
            document.getElementById('accordionOption5').innerHTML = option5;
            document.getElementById('accordionOption6').innerHTML = option6;
            document.getElementById('accordionOption7').innerHTML = option7;


        }

        function updateDepositOptions() {
            var depositSelect = document.getElementById("deposit_percentage");
            var selectedValue = depositSelect.value;
            var firstHomeGuarantee = document.getElementById("first_home_guarantee").value;
            var guarantor = document.getElementById("guarantor").value;

            // Default options
            var defaultOptions = [
                { value: "0.2", text: "20%" },
                { value: "0.15", text: "15%" },
                { value: "0.1", text: "10%" }
            ];

            // Options when first home buyer guarantee is yes
            var fhgOptions = [
                
                { value: "0.2", text: "20%" },
                { value: "0.15", text: "15%" },
                { value: "0.1", text: "10%" },
                { value: "0.05", text: "5%" }
            ];

            // Options when guarantor is yes
            var guarantorOptions = [
                
                { value: "0.2", text: "20%" },
                { value: "0.15", text: "15%" },
                { value: "0.1", text: "10%" },
                { value: "0.05", text: "5%" }
            ];

            // Clear existing options
            depositSelect.innerHTML = "";

            // Determine which options to use based on selections
            var optionsToUse = defaultOptions;
            if (firstHomeGuarantee === "first_home_guarantee_yes") {
                optionsToUse = fhgOptions;
            } else if (guarantor === "guarantor_yes") {
                optionsToUse = guarantorOptions;
            }

            // Populate select with options
            optionsToUse.forEach(function(option) {
                var optionElem = document.createElement("option");
                optionElem.value = option.value;
                optionElem.textContent = option.text;
                depositSelect.appendChild(optionElem);
            });
            if (selectedValue && optionsToUse.find(option => option.value === selectedValue)) {
                depositSelect.value = selectedValue;
            } else {
                // If the previously selected value is not in the new options, select the first option by default
                depositSelect.value = optionsToUse[0].value;
            }
        }


        function formatPrice(input) {
            // Remove non-digit characters
            var num = input.value.replace(/\D/g, '');
            // Format with commas
            input.value = num.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function findMaxHousePrice(){
            var savings = parseFloat(document.getElementById('current_savings').value.replace(/,/g, ''));

            var initial_test_val = 40*savings;
            if(initial_test_val < 100000){
                    alert("Insufficient deposit for any house > $100k. Unfortunately, you're going to need a bigger deposit saved.");
                    return null;
            }
            var test_val = initial_test_val;
            var calc_outputs = calculate(test_val);
            var amount_req = calc_outputs.amount_req;
            var iterations = Math.round(test_val/1000)-9;
        

            for(let i = 0; i< iterations;i++){
                
                calc_outputs = calculate(test_val);
                amount_req = calc_outputs.amount_req;
                console.log("test value:" + test_val);
                console.log("amount req:" + amount_req);
                console.log("savings:" + savings);
                if(amount_req <= savings){
                    display(test_val);
                    return{
                        house_price: test_val
                    };
                }
                test_val = test_val - 1000;
                if(test_val < 100000){
                    alert("Insufficient deposit for any house > $100k. Unfortunately, you're going to need a bigger deposit saved.");
                    return null;
                }
            }
            
            
            
        }


        function calculate(house_price) {
            var house_type = document.getElementById('house_type').value;
            var state = document.getElementById('state').value;
            var regional = document.getElementById('regional').value;
            var deposit_percentage = parseFloat(document.getElementById('deposit_percentage').value);
            var first_home_buyer = document.getElementById('first_home_buyer').value;
            var first_home_guarantee = document.getElementById('first_home_guarantee').value;
            var guarantor = document.getElementById('guarantor').value;


             // Show values in a dialog box
            // var message = "House Type: " + house_type + "\n" + "State: " + state + "\n" + "Regional: " + regional + "\n" + "House Price: $" + house_price.toLocaleString('en-US') + "\n" +
            //"Deposit Percentage: " + (deposit_percentage * 100) + "%\n" + "First Home Buyer: " + first_home_buyer + "\n" + "First Home Guarantee: " + first_home_guarantee ;
             
            // alert("Input Values:\n\n" + message);


            // Constants for fees
            var FHOG = 0;
            var stamp_duty_fee = 0;
            var other_govt_costs = 6000;
            var conveyancing_fees = 1000;
            var LMI = 8000;
            var stamp_duty_concession =  0;

            var LMI_ratio = 0;
            if(deposit_percentage == 0.05){
                LMI_ratio = 0.043;
            }
            if(deposit_percentage == 0.1){
                LMI_ratio = 0.025;
            }
            if(deposit_percentage == 0.15){
                LMI_ratio = 0.013;
            }
            if(deposit_percentage == 0.2){
                LMI_ratio = 0;
            }

            LMI = house_price*(1-deposit_percentage)*LMI_ratio;

            if( first_home_guarantee == "first_home_guarantee_yes"){
                LMI = 0;
            }

            if( guarantor == "guarantor_yes"){
                LMI = 0;
            }

            if(state == "NSW"){
                other_govt_costs = 348;

                if(house_price<=364000){
                    stamp_duty_fee = 1564 + (3.5*(house_price-97000)/100)
                }
                if(house_price> 364000 && house_price <= 1212000){
                    stamp_duty_fee = 10909 + (4.5*(house_price - 364000)/100)
                }
                if(house_price > 1212000){
                    stamp_duty_fee = 49069 + (5.5*(house_price-1212000)/100)
                }
                
                if(first_home_buyer == "first_home_buyer_yes"){
                    if(house_type == "build" && house_price <= 600000){
                        FHOG = 10000;
                    }
                    if(house_type == "land" && house_price <= 750000){
                        FHOG = 10000;
                    } 
                    if(house_type == "established"){
                        FHOG = 0;
                    }
                    if(house_price <= 800000){
                        stamp_duty_concession = stamp_duty_fee
                    }
                    if (house_price > 800000 && house_price <= 1000000){
                        stamp_duty_concession = stamp_duty_fee*(1-((house_price-800000)/200000));

                    }
                    if(house_price > 1000000){
                        stamp_duty_concession = 0;
                    }
                } 
                
            }

            if(state == "VIC"){
                other_govt_costs = 0.0025*house_price + 154;

                if(house_price <= 130000){
                    stamp_duty_fee = 350 + 0.024*(house_price-25000);
                }
                if(house_price > 130000 && house_price <= 440000){
                    stamp_duty_fee = 2870 + 0.05*(house_price-130000);
                }
                if(house_price > 440000 && house_price <= 550000){
                    stamp_duty_fee = 18370 + 0.06*(house_price-440000);
                }
                if(house_price > 550000 && house_price <= 960000){
                    stamp_duty_fee = 2870 + 0.06*(house_price-130000);
                }
                if(house_price > 960000 && house_price <= 2000000){
                    stamp_duty_fee = 0.055*house_price;
                }
                if(house_price > 2000000){
                    stamp_duty_fee = 110000 + 0.065*(house_price-2000000);
                }

                if(first_home_buyer == "first_home_buyer_yes"){
                    if(house_type != "established" && house_price <= 750000){
                        FHOG = 10000;
                        if(regional == "Yes"){
                            FHOG = 20000;
                        }
                    } else {
                        FHOG = 0;
                    } 
                    if(house_price <= 600000){
                        stamp_duty_concession = stamp_duty_fee
                    }

                    if (house_price > 600000 && house_price <= 750000){
                        stamp_duty_concession = stamp_duty_fee
                    }
                    if(house_price > 750000){
                        stamp_duty_concession = 0;
                    }
                }
                
            }

            if(state == "SA"){
                other_govt_costs = 0.0097*house_price;
                if(house_price<=200000){
                    stamp_duty_fee = 2830 + 4*(house_price-100000)/100;
                }
                if(house_price >200000 && house_price < 250000){
                    stamp_duty_fee = 6830 + 4.25*(house_price - 200000)/100;
                }
                if(house_price >250000 && house_price < 300000){
                    stamp_duty_fee = 8955 + 4.75*(house_price - 250000)/100;
                }
                if(house_price >300000 && house_price < 500000){
                    stamp_duty_fee = 11330 + 5*(house_price - 300000)/100;
                }
                if(house_price >= 500000){
                    stamp_duty_fee = 21330 + 5.5*(house_price - 500000)/100;
                }
                
                if(first_home_buyer == "first_home_buyer_yes"){
                    if(house_type != "established"){
                        FHOG = 15000;
                        stamp_duty_concession = stamp_duty_fee;
                    } else {
                        FHOG = 0;
                        stamp_duty_concession = 0;
                    }
                }
                
            }
            if(state == "QLD"){
                other_govt_costs = 151 + 0.0036*house_price;

                var real_stamp_duty = 0;
                if(house_price <= 350000){
                    real_stamp_duty = 0.1*(350000/100);
                }
                if(house_price>350000 && house_price<=540000){
                    real_stamp_duty = 3500 + 3.5*((house_price-350000)/100)
                }
                if(house_price>540000 && house_price<=1000000){
                    real_stamp_duty = 10150 + 4.5*((house_price-540000)/100)
                }
                if(house_price>1000000){
                    real_stamp_duty = 30850 + 5.75*((house_price-1000000)/100)
                }

                if(first_home_buyer == "first_home_buyer_yes"){
                    if(house_type != "established"){
                        FHOG = 30000;
                    } else {
                        FHOG = 0;
                    }
                    if(house_type != "land"){

                        if(house_price<710000){
                            stamp_duty_concession = 17350;
                        }
                        if(house_price >= 710000 && house_price < 800000){
                            stamp_duty_concession = 17350- 1735*(math.floor((house_price-710000)/10000)+1);
                        }
                        if(house_price > 800000){
                            stamp_duty_concession = 0;
                        }
                    } else {
                        if(house_price < 360000){
                            stamp_duty_concession = 10675;
                        }
                        if(house_price >=360000 && house_price < 500000){
                            stamp_duty_concession = 10675- 710*(math.floor((house_price-360000)/10000)+1);
                        }

                        if(house_price >= 500000){
                            stamp_duty_concession = 0;
                        }


                    }
                }
                stamp_duty_fee = real_stamp_duty + stamp_duty_concession;

            }

            if( state == "WA"){
                other_govt_costs = 452+0.0001875*house_price;
                var real_stamp_duty = 0;
                if(house_price <=120000){
                    stamp_duty_fee = 1.90*(house_price/100);
                }
                if(house_price > 120000 && house_price <=150000){
                    stamp_duty_fee = 2280 + 2.85*((house_price-120000)/100);
                }
                if(house_price > 150000 && house_price <=360000){
                    stamp_duty_fee = 3135 + 3.8*((house_price-150000)/100);
                }
                if(house_price > 360000 && house_price <=725000){
                    stamp_duty_fee = 11115 + 4.75*((house_price-360000)/100);
                }
                if(house_price > 725000){
                    stamp_duty_fee = 28453 + 5.15*((house_price-725000)/100);
                }
                if(first_home_buyer == "first_home_buyer_yes"){
                    if(house_type != "established" && house_price <=750000){
                        FHOG = 10000;
                    } else {
                        FHOG = 0;
                    }
                    if(house_price < 450000){
                        stamp_duty_concession = stamp_duty_fee;
                    }
                    if(house_price >=450000 && house_price < 600000){
                        real_stamp_duty = 0.1501*(house_price-450000);
                        stamp_duty_concession = stamp_duty_fee - real_stamp_duty;
                    }
                    if(house_price >=600000){
                        stamp_duty_concession = 0;
                    }
                }
            }

            if(state == "ACT"){
                other_govt_costs = 645;
                if(house_price<=260000){
                    stamp_duty_fee = 0.4*(house_price/100);
                }
                if(house_price > 260000 && house_price <= 300000){
                    stamp_duty_fee = 1040 + 2.2*(house_price-260000)/100
                }
                if(house_price > 300000 && house_price <= 500000){
                    stamp_duty_fee = 1920 + 3.4*(house_price-300000)/100
                }
                if(house_price > 500000 && house_price <= 750000){
                    stamp_duty_fee = 8720 + 4.32*(house_price-500000)/100
                }
                if(house_price > 750000 && house_price <= 1000000){
                    stamp_duty_fee = 19520 + 5.9*(house_price-750000)/100
                }
                if(house_price > 1000000 && house_price <= 1455000){
                    stamp_duty_fee = 34270 + 6.4*(house_price-1000000)/100
                }
                if(house_price > 1455000){
                    stamp_duty_fee = 4.54*(house_price-1455000)/100
                }

                if(first_home_buyer == "first_home_buyer_yes"){
                    if(house_price < 1000000){
                        stamp_duty_concession = stamp_duty_fee;
                    }
                    if(house_price>=1000000){
                        stamp_duty_concession = 34270;
                    }

                }

                
                FHOG = 0;
            }

            if(state == "NT"){
                other_govt_costs = 369;
                if(house_price < 525000){
                    stamp_duty_fee = 0.06571441*(house_price/1000)*(house_price/1000)+15*(house_price/1000);
                }
                if(house_price >= 525000 && house_price < 3000000){
                    stamp_duty_fee = 0.0495*house_price;
                }
                if(house_price >= 3000000 && house_price < 5000000){
                    stamp_duty_fee = 0.0575*house_price;
                }
                if(house_price >=  5000000){
                    stamp_duty_fee = 0.0595*house_price;
                }


                if(first_home_buyer == "first_home_buyer_yes" && house_type != "established"){
                    FHOG = 10000;
                    if(house_type=="land"){
                        stamp_duty_concession = stamp_duty_fee;
                    }
                }
                
            }

            if(state == "TAS"){
                other_govt_costs = 422;
                if(house_price<=200000){
                    stamp_duty_fee = 1560 + 3.5*(house_price-75000)/100
                }
                if(house_price > 200000 && house_price <= 375000){
                    stamp_duty_fee = 5935 + 4*(house_price-200000)/100
                }
                if(house_price > 375000 && house_price <= 725000){
                    stamp_duty_fee = 12935 + 4.25*(house_price-375000)/100
                }
                if(house_price > 725000 ){
                    stamp_duty_fee = 27810 + 4.5*(house_price-725000)/100
                }
                if(first_home_buyer == "first_home_buyer_yes"){
                    if(house_type != "established"){
                        FHOG = 10000;
                    }
                    if(house_price<750000){
                        stamp_duty_concession = stamp_duty_fee;
                    }
                }   

            }
            stamp_duty_concession = (-1)*stamp_duty_concession;


            // Calculate total fees
            var total_fees = stamp_duty_fee + other_govt_costs + conveyancing_fees + LMI + stamp_duty_concession;

            // Calculate true deposit and actual deposit
            var true_deposit = house_price * deposit_percentage;
            var loan_figure = house_price - true_deposit;
            var amount_req = true_deposit + total_fees - (first_home_buyer ? FHOG : 0);
            var loan_value = house_price - true_deposit;

            var total_deposit_available = amount_req + FHOG;
            
            return { 
                true_deposit: true_deposit,
                loan_value: loan_value,
                deposit_percentage: deposit_percentage,
                FHOG: FHOG,
                total_fees: total_fees,
                stamp_duty_fee: stamp_duty_fee,
                stamp_duty_concession: stamp_duty_concession,
                other_govt_costs: other_govt_costs,
                amount_req: amount_req,
                conveyancing_fees: conveyancing_fees,
                LMI: LMI,
                first_home_buyer:first_home_buyer,
                first_home_guarantee:first_home_guarantee,
                guarantor:guarantor,
                house_type:house_type,
                deposit_percentage:deposit_percentage,
                total_deposit_available: total_deposit_available
            };

            
        }
        function sendToGoogleSheet(data) {
            var url = 'https://script.google.com/macros/s/AKfycbwibu7TZXBfXifMsk-ObcK0o3IPPZh3Eg-SIEpFWQvVTJrr2iJZed9VVeh-XqWBiUVtJA/exec'; // Replace with your actual web app URL
            var payload = JSON.stringify(data);

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: payload
            }).then(response => {
                if (response.ok) {
                    console.log('Data successfully sent to Google Sheets.');
                } else {
                    console.error('Error sending data to Google Sheets.');
                }
            }).catch(error => {
                console.error('Fetch error:', error);
            });
        }
        
        function display(maxHousePrice){
            var outputs = calculate(maxHousePrice);
            

            if(!outputs){
                alert("Please ensure you select an option for every input.");
                return;
            }
            // Format amounts with commas for thousands separator
            var house_price = maxHousePrice;
            var formatted_house_price = maxHousePrice.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            var formatted_loan_value = outputs.loan_value.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            var formatted_true_deposit = outputs.true_deposit.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            var formatted_fhog = outputs.FHOG.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            var formatted_tot_fees = outputs.total_fees.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            var formatted_stamp_duty = outputs.stamp_duty_fee.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            var formatted_stamp_duty_conc = outputs.stamp_duty_concession.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            var formatted_other_govt_costs = outputs.other_govt_costs.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            var formatted_amount_req = outputs.amount_req.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            var formatted_conv_fees = outputs.conveyancing_fees.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            var formatted_LMI = outputs.LMI.toLocaleString('en-US', { style: 'currency', currency: 'USD' });


            // Display the results on the page
            document.getElementById('maxHousePrice').innerHTML = "<p class='bold'>Maximum Property Value Budget: " + formatted_house_price + "</p>";
            document.getElementById('amountRequired').innerHTML = "<p class='bold'>Savings Required: " + formatted_amount_req + "</p>";
            document.getElementById('FHOG').innerHTML = "<p>First Home Owner Grant: " + formatted_fhog + "</p>";
            document.getElementById('total_fees').innerHTML = "<p class='bold'>Total Fees: " + formatted_tot_fees + "</p>";
            document.getElementById('stampDutyResult').innerHTML = "<p>Stamp Duty: " + formatted_stamp_duty + "</p>";
            document.getElementById('stampDutyConc').innerHTML = "<p>Stamp Duty Concessions: " + formatted_stamp_duty_conc + "</p>";
            document.getElementById('otherGovtCostsResult').innerHTML = "<p>Other Govt Costs: " + formatted_other_govt_costs + "</p>";
            document.getElementById('Conveyancing').innerHTML = "<p>Conveyancing Fees: " + formatted_conv_fees + "</p>";
            document.getElementById('LMI').innerHTML = "<p>LMI (Lenders Mortgage Insurance): " + formatted_LMI + "</p>";
            document.getElementById('loanValue').innerHTML = "<p class='bold'>Loan Value: " + formatted_loan_value + "</p>";

            populateAccordions(outputs);

            var data = {
                house_type: outputs.house_type,
                state: outputs.state,
                regional: outputs.regional,
                deposit_percent: outputs.deposit_percentage,
                fhb: outputs.first_home_buyer,
                fhbg: outputs.first_home_guarantee,
                guarantor: outputs.guarantor,
                maxHousePrice: house_price,
                loan_value: formatted_loan_value,
                true_deposit: formatted_true_deposit,
                FHOG: formatted_fhog,
                total_fees: formatted_tot_fees,
                stamp_duty_fee: formatted_stamp_duty,
                stamp_duty_concession: formatted_stamp_duty_conc,
                other_govt_costs: formatted_other_govt_costs,
                amount_req: formatted_amount_req,
                conveyancing_fees: formatted_conv_fees,
                LMI: formatted_LMI
            };

            // Send data to Google Sheets
            sendToGoogleSheet(data);
        }

        document.addEventListener('DOMContentLoaded', function () {
            var accordions = document.getElementsByClassName('accordion');
            for (var i = 0; i < accordions.length; i++) {
                accordions[i].addEventListener('click', function () {
                    this.classList.toggle('active');
                    var panel = this.nextElementSibling;
                    if (panel.style.display === 'block') {
                        panel.style.display = 'none';
                    } else {
                        panel.style.display = 'block';
                    }
                });
            }
        });

    </script>
    
</body>
</html>
